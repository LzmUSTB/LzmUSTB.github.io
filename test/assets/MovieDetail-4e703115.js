import{_ as E,i as N,r as l,j as Y,u as $,o as H,A as v,k as K,b as d,c as _,l as m,v as L,d as t,t as n,F as S,f as I,m as P,q as X,s as G,p as J,g as Q,h as Z}from"./index-8eea6d4b.js";const h=y=>(J("data-v-7296af87"),y=y(),Q(),y),ee={class:"loading"},te={class:"maincontainer_md"},se={class:"movieinfo"},oe=h(()=>t("img",{class:"filter",src:Z},null,-1)),ie=["src"],ae=["src"],le=["src"],ne={class:"textinfo hide"},ce={class:"title"},de={style:{"margin-top":"2rem"}},_e={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ue={class:"rate"},re=h(()=>t("span",{class:"rate_fixed"},"/10",-1)),ve={class:"catalog"},me={class:"catalog_item button_2"},he={class:"information texture_glass"},ge=h(()=>t("p",{class:"info_title"},"Plot",-1)),pe={class:"userRate"},fe=h(()=>t("span",{style:{"mix-blend-mode":"multiply"}},"YourRate:",-1)),ke=["onClick"],Le={class:"comments"},ye=h(()=>t("div",{class:"comments_title"},[t("p",null,"Comments"),t("p",null,"■■■■")],-1)),xe={class:"comment"},be={class:"comment"},Ce={class:"comment_header"},Se={class:"comment_account"},we={class:"comment_time"},De={class:"comment_content"},Ie={class:"likes"},Re=["onClick"],Me={class:"comment"},We=h(()=>t("div",{class:"comment_header"},[t("p",{class:"comment_account"},"There is no comment yet.")],-1)),Te=[We],Ae={__name:"MovieDetail",props:["searchKey"],setup(y){const a=N(),g=l("＋Add to WatchList"),w=l(!0),D=l(["☆","☆","☆","☆","☆","☆","☆","☆","☆","☆"]),p=Y(()=>a.Token),W=$(),u=l(""),f=l(["0"]),x=l(""),b=l([]),i=l({}),k=l(["0"]),R=l([]);l(!0);const C=l([]);H(()=>{u.value=W.currentRoute.value.query.keyword,v({url:"/getMovieInfo",method:"get",params:{movie_id:u.value,user_id:a.id}}).then(e=>{console.log(e);const s=e.data.Rate;M(s-1),i.value=e.data.movie_info,e.data.Message==!0&&(g.value="✔In the WatchList"),C.value=e.data.comments_by_this_user_about_this_movie,b.value=e.data.all_comments_about_this_movie;let o="../assets/images/"+i.value.movie_img_id+".jpg";if(i.value.movie_img_id=new URL(o,import.meta.url),i.value.movie_genre=i.value.movie_genre.split(","),!p.value){w.value=!1;return}b.value.forEach(c=>{for(let r=0;r<C.value.length;r++)if(C.value[r].comment_id==c.comment_id){c.isLiked=!0,R.value.push(c.comment_id);return}console.log(C.value),c.isLiked=!1}),w.value=!1}).catch(e=>{console.log(e)})});const T=()=>{console.log(a.id),console.log(a.Token),v({url:"/LikesUpdateServlet",method:"get",headers:{Authorization:a.Token},params:{comment_account:a.id,user_id:a.id,add:k.value,minus:f.value}}).then(e=>{console.log(e),console.log("success")}).catch(e=>{console.log(e)})};K(()=>{T()});function A(){var e=new Date,s=e.getFullYear(),o=("0"+(e.getMonth()+1)).slice(-2),c=("0"+e.getDate()).slice(-2),r=("0"+e.getHours()).slice(-2),O=("0"+e.getMinutes()).slice(-2),V=("0"+e.getSeconds()).slice(-2),q=s+"-"+o+"-"+c+" "+r+":"+O+":"+V;return q}const B=()=>{console.log("begin submitComment");const e=A();v({url:"/postComment",method:"get",headers:{Authorization:a.Token},params:{comment_content:x.value,comment_time:e,comment_movie_id:u.value,comment_account:a.id}}).then(s=>{console.log(s),x.value="",window.location.reload()}).catch(s=>{console.log(s)})},U=()=>{g.value=="✔In the WatchList"?v({url:"/DeleteWatchListServlet",method:"get",params:{movie_id:u.value,user_id:a.id}}).then(e=>{console.log(e),g.value="＋Add to WatchList"}).catch(e=>{console.log(e)}):v({url:"/InsertWatchListServlet",method:"get",params:{movie_id:u.value,user_id:a.id}}).then(e=>{console.log(e),g.value="✔In the WatchList"}).catch(e=>{console.log(e)})},j=e=>{if(!p.value)return;if(R.value.includes(e.comment_id)){const o=f.value.indexOf(e.comment_id);o!==-1?f.value.splice(o,1):f.value.push(e.comment_id),e.comment_likes+=e.isLiked?-1:1,e.isLiked=!e.isLiked,console.log(f.value);return}const s=k.value.indexOf(e.comment_id);s!==-1?k.value.splice(s,1):k.value.push(e.comment_id),e.comment_likes+=e.isLiked?-1:1,e.isLiked=!e.isLiked,console.log(k.value)},z=e=>{v({url:"/RateServlet",method:"get",params:{movie_id:u.value,user_id:a.id,rate:e}}).then(s=>{console.log(s)}).catch(s=>{console.log(s)})},F=e=>{M(e),z(e+1)},M=e=>{console.log(e+1),D.value=["☆","☆","☆","☆","☆","☆","☆","☆","☆","☆"];for(let s=0;s<e+1;s++)D.value[s]="★"};return(e,s)=>(d(),_(S,null,[m(t("div",ee,null,512),[[L,w.value]]),t("div",te,[t("div",se,[oe,t("img",{class:"poster",src:i.value.movie_img_id},null,8,ie),t("img",{class:"box",src:i.value.movie_img_id},null,8,ae),t("img",{class:"box box2",src:i.value.movie_img_id},null,8,le),t("div",ne,[t("p",ce,n(i.value.movie_title+" ("+i.value.movie_year+")"),1),t("p",de,[t("div",_e,[t("div",null,[t("span",ue,"★ "+n(i.value.movie_rate),1),re]),m(t("div",{class:"add",onClick:U},n(g.value),513),[[L,p.value]])])]),t("div",ve,[(d(!0),_(S,null,I(i.value.movie_genre,o=>(d(),_("div",me,n(o),1))),256))]),t("div",he,[ge,t("p",null,n(i.value.movie_info),1)]),m(t("div",pe,[fe,(d(!0),_(S,null,I(D.value,(o,c)=>(d(),_("span",{class:"stars",onClick:r=>F(c)},n(o),9,ke))),256))],512),[[L,p.value]]),t("div",Le,[ye,m(t("div",xe,[t("div",null,[m(t("textarea",{"onUpdate:modelValue":s[0]||(s[0]=o=>x.value=o),placeholder:"Write your comment"},null,512),[[P,x.value]])]),t("div",{class:"likes"},[t("div",{class:"submit button_1",onClick:B},"Submit")])],512),[[L,p.value]]),(d(!0),_(S,null,I(b.value,o=>(d(),_("div",be,[t("div",Ce,[t("p",Se,n(o.commenter_id),1),t("p",we,n(o.comment_time),1)]),t("div",De,n(o.comment_content),1),t("div",Ie,[X(n(o.comment_likes)+" ",1),t("span",{class:G(o.isLiked?"liked":""),onClick:c=>j(o)},"👍",10,Re)])]))),256)),m(t("div",Me,Te,512),[[L,b.value.length==0]])])])])])],64))}},Ue=E(Ae,[["__scopeId","data-v-7296af87"]]);export{Ue as default};
